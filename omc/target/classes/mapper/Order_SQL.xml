<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="order">

	<!-- selectOrderOID (주문번호로 주문 정보 조회) -->
	<select id="selectOrderOId" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT
			* 
		FROM
			ORDERCOMMAND 
		WHERE
			OD_OID = #{OD_OID}
	]]>
	</select>
	
	<!-- 주문 테이블의 OBNUMBER 최대값 -->
	<select id="selectOrderODNumMax" resultType="hashmap">
	<![CDATA[
		SELECT
			MAX(OD_NUM) MAX
		FROM
			ORDERCOMMAND
	]]>
	</select>
	
	<!-- selectOrderMemberId (주문자:MEM_ID로 주문 정보 조회) -->
	<select id="selectOrderMemberId" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT
			* 
		FROM
			ORDERCOMMAND 
		WHERE
			OD_ID=#{MEM_ID}
	]]>
	</select>

	<!-- orderList (주문 정보 리스트) -->
	<select id="orderList" resultType="hashmap">
	<![CDATA[
		SELECT
			* 
		FROM
			ORDERCOMMAND
		ORDER BY
		OD_OID DESC
	]]>
	</select>
	
	<!-- orderListSearch (주문 정보 리스트 검색) -->
	<select id="orderListSearch" parameterType="hashmap" resultType="hashmap">
		SELECT
			*
		FROM
			ORDERCOMMAND
		<where>
			<if test="CONDITION!=NULL">
				<if test="CONDITION.equals('OMAIL')">
					OD_ID LIKE '%'||#{KEYWORD}||'%'
				</if>
				<if test="CONDITION.equals('OID')">
					OD_OID = #{KEYWORD}
				</if>
				<if test="CONDITION.equals('OPRODUCT')">
					OD_GNAME LIKE '%'||#{KEYWORD}||'%'
				</if>
				<if test="CONDITION.equals('OSTATUS')">
					OD_STATUS = #{KEYWORD}
				</if>
			</if>
		</where>		
	</select>
	
	<!-- insertOrderDirect (상품 바로 구매정보 입력) -->
	<insert id="insertOrderDirect" parameterType="hashmap">
	<![CDATA[
		INSERT INTO
			ORDERCOMMAND
		VALUES(
			OD_OID_SEQ.NEXTVAL,
			'',
			#{OD_ID},
			#{OD_NAME},
			SYSDATE,
			#{GD_GID},
			#{GD_GNAME},
			#{OD_COUNT},
			#{GD_PRICE},
			#{GD_DCPRICE},
			#{OD_TOTAL},
			#{OD_PHONE},
			#{OD_ZIPCODE},
			#{OD_ADD1},
			#{OD_ADD2},
			'상품준비중',
			'100254889564'
		)
	]]>
	</insert>

	<!-- insertOrderBasket (장바구니 구매정보 입력) -->
	<insert id="insertOrderCart" parameterType="hashmap">
	<![CDATA[
		INSERT INTO
			ORDERCOMMAND 
		VALUES(
			OD_OID_SEQ.NEXTVAL,
			#{OD_NUM},
			#{OD_ID},
			#{OD_NAME},
			SYSDATE,
			#{OD_GID},
			#{OD_GNAME},
			#{OD_COUNT},
			#{OD_PRICE},
			#{OD_DCPRICE},
			#{OD_TOTAL},
			#{OD_PHONE},
			#{OD_ZIPCODE},
			#{OD_ADD1},
			#{OD_ADD2},
			'상품준비중',
			'100254889564'
		)
	]]>
	</insert>
	
	<!-- updateOrderId (주문 정보 수정) -->
	<update id="updateOrderDirect" parameterType="hashmap">
	<![CDATA[
		UPDATE
			ORDERCOMMAND
		SET
			OD_STATUS=#{OD_STATUS}
		WHERE
			OD_OID=#{OD_OID}
	]]>
	</update>
	
	<!-- [selectODNumMax] 기존 주문번호의 최대값-->
	<select id="selectODNumMax" resultType="hashmap">
	<![CDATA[
		SELECT 
			MAX(OD_NUM) MAX 
		FROM 
			ORDERCOMMAND
	]]>
	</select>
	
	<!-- [insertPay] 결제 정보 입력 -->
	<insert id="insertPay" parameterType="hashmap">
	<![CDATA[
		INSERT INTO
			PAYMENT
		VALUES(
			PAY_SEQ.NEXTVAL,
			#{OD_NUM},
			#{TOTALPAY},
			''
		)
	]]>
	</insert>
	
	<!-- [selectOrderODNum] (장바구니번호로 주문 정보 조회) -->
	<select id="selectOrderODNum" parameterType="hashmap" resultType="hashmap"> 
	<![CDATA[
		SELECT
			* 
		FROM
			ORDERCOMMAND 
		WHERE
			OD_NUM = #{OD_NUM}
	]]>
	</select>
	
	<!-- [selectTotalPay] 총 결제 금액 -->
	<select id="selectTotalPay" parameterType="hashmap" resultType="hashmap">
	<![CDATA[
		SELECT TOTALPAY
		FROM PAYMENT
		WHERE ODNUM = #{ODNUM}
	]]>
	</select>

</mapper>